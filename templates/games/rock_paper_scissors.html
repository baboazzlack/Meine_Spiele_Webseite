{% extends "base.html" %}
{% load static %}

{% block title %}Schere, Stein, Papier - GFN Retro Hub{% endblock %}

{% block content %}
<main class="main-content">
    <h2>Schere, Stein, Papier</h2>
    <p id="instruction">Wähle einen Spielmodus.</p>

    <div id="difficultySelector">
        <button class="mode-btn" data-mode="single">Einzelne Runde</button>
        <button class="mode-btn" data-mode="bestOf5">Best of 5</button>
        <button class="mode-btn" data-mode="firstTo5">First to 5</button>
    </div>

    <div id="game-container" style="margin-top: 30px; display: none;">
        <button class="choice-btn">Schere</button>
        <button class="choice-btn">Stein</button>
        <button class="choice-btn">Papier</button>
    </div>

    <div id="result-container" style="margin-top: 30px; min-height: 100px; display: none;">
        <p id="result-text" style="font-size: 1.5em;"></p>
        <p id="score-text" style="font-size: 1.2em;"></p>
        <button id="resetButton" style="display:none;">Neues Spiel</button>
    </div>
</main>
{% endblock %}

{% block extra_js %}
<style>
    .mode-btn, .choice-btn { font-family: 'Press Start 2P', cursive; cursor: pointer; padding: 10px 15px; margin: 5px; }
</style>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const choices = ['Schere', 'Stein', 'Papier'];
        let playerScore = 0, computerScore = 0, roundsPlayed = 0;
        let gameMode = ''; // 'single', 'bestOf5', 'firstTo5'
        let targetScore = 0;

        const modeButtons = document.querySelectorAll('.mode-btn');
        const choiceButtons = document.querySelectorAll('.choice-btn');
        const resultText = document.getElementById('result-text');
        const scoreText = document.getElementById('score-text');
        const instruction = document.getElementById('instruction');
        const resetButton = document.getElementById('resetButton');
        const gameContainer = document.getElementById('game-container');
        const resultContainer = document.getElementById('result-container');
        const difficultySelector = document.getElementById('difficultySelector');

        modeButtons.forEach(button => button.addEventListener('click', (e) => startGame(e.target.dataset.mode)));
        choiceButtons.forEach(button => button.addEventListener('click', (e) => playRound(e.target.textContent)));
        resetButton.addEventListener('click', resetGame);
        
        function startGame(mode) {
            gameMode = mode;
            playerScore = 0;
            computerScore = 0;
            roundsPlayed = 0;
            
            if (mode === 'bestOf5') targetScore = 3;
            if (mode === 'firstTo5') targetScore = 5;

            instruction.textContent = 'Wähle deine Waffe!';
            difficultySelector.style.display = 'none';
            gameContainer.style.display = 'block';
            resultContainer.style.display = 'block';
            resetButton.style.display = 'none';
            updateScoreText();
        }

        function playRound(playerSelection) {
            const computerSelection = choices[Math.floor(Math.random() * choices.length)];
            let result = '';

            if (playerSelection === computerSelection) {
                result = `Unentschieden! Beide wählten ${playerSelection}.`;
                resultText.style.color = '#ccc';
            } else if ((playerSelection === 'Stein' && computerSelection === 'Schere') || (playerSelection === 'Schere' && computerSelection === 'Papier') || (playerSelection === 'Papier' && computerSelection === 'Stein')) {
                playerScore++;
                result = `Du gewinnst! ${playerSelection} schlägt ${computerSelection}.`;
                resultText.style.color = '#00ff00';
            } else {
                computerScore++;
                result = `Du verlierst! ${computerSelection} schlägt ${playerSelection}.`;
                resultText.style.color = '#ff0000';
            }
            
            roundsPlayed++;
            resultText.textContent = result;
            updateScoreText();
            checkGameOver();
        }

        function updateScoreText() {
            scoreText.textContent = `Spieler: ${playerScore} - Computer: ${computerScore}`;
        }
        
        function checkGameOver() {
            if (gameMode === 'single' || (gameMode === 'bestOf5' && roundsPlayed >= 5) || (playerScore >= targetScore || computerScore >= targetScore)) {
                let finalMessage = '';
                if (playerScore > computerScore) finalMessage = 'Du hast das Match gewonnen!';
                else if (computerScore > playerScore) finalMessage = 'Der Computer hat das Match gewonnen!';
                else finalMessage = 'Match unentschieden!';
                
                resultText.textContent = finalMessage;
                gameContainer.style.display = 'none';
                resetButton.style.display = 'inline-block';
            }
        }
        
        function resetGame() {
            difficultySelector.style.display = 'block';
            gameContainer.style.display = 'none';
            resultContainer.style.display = 'none';
            instruction.textContent = 'Wähle einen Spielmodus.';
            resultText.textContent = '';
        }
    });
</script>
{% endblock %}